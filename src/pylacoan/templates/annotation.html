<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>pylacoan</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="{{url_for('static', filename='css/styles.css')}}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://fonts.cdnfonts.com/css/noto-sans" rel="stylesheet">
    <style>
        .interlinear-wrapper {clear: both; text-align: left;}
        .interlinear {float: left; margin: 0.25em; text-align: left;}
        .interlinear .obj, .interlinear .gls, .interlinear-wrapper {display: block; margin: 2px 0;}

        .ftr, .cmt { clear: both; }

        .ftr::before {
            content: '‘';
        }

        .ftr::after {
            content: '’';
        }

        .oft::before {
            content: '‘';
        }

        .oft::after {
            content: '’';
        }


        li.example{
            font-family: 'Noto Sans', sans-serif;
            border: 3px solid black;
            padding: 0.5em;
            margin: 20px 0;
        }

        input {
            border: none;
            background-color: #F5F5F5;
            font-family: monospace;
        }

        ol.example {
          list-style-type: lower-alpha;
      }

      ol.subexample {
          list-style-type: lower-alpha;
      }

      .cmt{ margin: 7px 0; }

      ol {
        counter-reset: list;
    }
    ol > li {
        list-style: none;
        counter-increment: list;
    }

    li.example::marker {
        content: "(" counter(list) ") \a0"
        }


    </style>
</head>
<body>
    <div class="d-flex" id="wrapper">
        <div id="page-content-wrapper">
            <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light border-bottom">
                <div class="container-fluid">

                    <div class="navbar-nav">

                    <a class="nav-link active" aria-current="page" href="#">Annotation</a>
                    <a class="nav-link" aria-current="page" href="/concordance">Concordance search</a>
                </div>

<!--                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mt-2 mt-lg-0">
                        <li class="nav-item active"><a id="dataExport" class="nav-link" href="#!">Export data</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!">Link</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="#!">Action</a>
                                <a class="dropdown-item" href="#!">Another action</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#!">Something else here</a>
                            </div>
                        </li>
                    </ul>
                </div>-->
            </div>
        </nav>
        <!-- Page content-->
        <div class="container-fluid h-100">
            <div class="row h-100">
                <div class="col-2" id="green">
                    <h4>Texts</h4>
                    <div class="list-group list-group-flush" id="textlist">
                    </div>
                </div>
                <div class="col-10" style="text-align: justify;">
                    <ol id="examples">
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<script src="https://code.jquery.com/jquery-3.1.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="static/js/scripts.js"></script>

<script>



    function loadText(textID) {
        $.get({url: "/textrecords", async: false, data: {textID:textID}, success: function(data){
            var exampleIDs = data;
            console.log("Loaded text "+textID+" ("+exampleIDs.length+"records)")
            $("#examples li").remove()
            for (let i = 0; i < exampleIDs.length; i++) {
                $.get({url: "/example", data: {id:exampleIDs[i]}, async: false,
                      success: function(data){$("#examples").append(data)}
                  });
                fitAll()
            }
        }});

    }
    function initialize() {

        $.get({url: "/texts", async: false, success: function(textIDs){
            for (let i = 0; i < textIDs.length; i++) {
                        // $("#textlist").append('<a id='+textIDs[i]+' class="textLink list-group-item list-group-item-action list-group-item-light p-3" href="#!">'+textIDs[i]+'</a>')
                $("#textlist").append(`<a class="list-group-item list-group-item-action list-group-item-light p-3" href="/annotation/${textIDs[i]}">${textIDs[i]}</a>`)
            }
            if ("{{text_id}}" != ""){
                loadText("{{text_id}}")
            } else {
                loadText(textIDs[0])
            }
        }});                

    }


    initialize()



    $( ".textLink" ).bind( "click", function() {
        loadText($(this).attr("id"))
    });

    $(document).ready(function() {
        $("#dataExport").click(function(){
            $.ajax({
                url: "/export",
            });

        }); 
    });

// var input = document.querySelector('input');
// console.log(input) // get the input element
// input.addEventListener('input', resizeInput); // bind the "resizeInput" callback on "input" event
// resizeInput.call(input); // immediately call the function

// $('input').on('input', (e) => {
//     console.log(e)
//     })  

    function fit(item) {
        if (item.value || !item.placeholder){
            item.style.width = item.value.length + 1 + "ch";
        }
    }

    $(document).on('input', 'input', function(event){
        fit(this)
    });

    $(document).on('change', 'input', function(event){
        res = $(this).val();
        id = $(this).attr('id');
        exampleItem = $(this).parents("li")[0]
        $.ajax({
            url: "/update",
            data: {value: res, target:id},
        });
    });

    function fitAll() {
        inputs = $("input")
        var i = 0, len = inputs.length;
        while (i < len) {
            fit(inputs[i])
            i++
        }
    };


    $(function() {
        $(document).on('keypress', 'input', function(event){
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if(keycode == '13'){
                res = $(this).val();
                id = $(this).attr('id');
                exampleItem = $(this).parents("li")[0]
                $.ajax({
                    url: "/update",
                    data: {value: res, target:id},
                    success: function(data){
                        $.ajax({ url: "/example", data: {id:exampleItem.id}, success: function(result){
                            result = $.parseHTML(result);
                            exampleItem.replaceWith(result[1]);
                            fitAll()
                        } });
                    }
                });
            }
        });
    });

    $("body").off('click', ".dropdown-menu li a").on('click', ".dropdown-menu li a", function(event){
        example_item = $(this).parents("li.example")[0]
        value = $(this).text()
        $.ajax({
            url: "/pick",
            data: {target:$(this).attr("id"), choice:value},
            success: function(result){
                result = $.parseHTML(result);
                example_item.replaceWith(result[1]);
                fitAll()
            }
        });
    });

</script>

</body>
</html>
